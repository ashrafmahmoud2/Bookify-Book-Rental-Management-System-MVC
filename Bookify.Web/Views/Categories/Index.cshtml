@model IEnumerable<Category>
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery antiforgery

@{
	ViewData["Title"] = "Categories";
}

<div class="card shadow-sm border border-primary border-2 border-dashed">
	<div class="card-header">
		<h3 class="card-title">
			<div class="symbol symbol-40px me-2">
				<div class="symbol-label fs-2 fw-semibold text-success"> <i class="fa-solid fa-layer-group text-primary"></i></div>
			</div>
			Categories
		</h3>
		<div class="card-toolbar">
			<a asp-controller="Categories" asp-action="Create" type="button" class="btn btn-sm btn-primary" @* data-bs-toggle="modal" data-bs-target="#kt_modal_1" *@>
				<i class="bi bi-plus-square-dotted"></i> Add
			</a>

			<div class="modal fade" tabindex="-1" id="kt_modal_1">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h3 class="modal-title">Modal title</h3>

							<!--begin::Close-->
							<div class="btn btn-icon btn-sm btn-active-light-primary ms-2" data-bs-dismiss="modal" aria-label="Close">
								<i class="ki-duotone ki-cross fs-1"><span class="path1"></span><span class="path2"></span></i>
							</div>
							<!--end::Close-->
						</div>

						<div class="modal-body">
						</div>

						<div class="modal-footer">
							<button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
							<button type="button" class="btn btn-primary">Save changes</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="card shadow-sm mt-12">
	<div class="card-header">
		<h3 class="card-title">
			<div id="kt_docs_search_handler_responsive"
				 class="d-flex align-items-center w-lg-400px"
				 data-kt-search-keypress="true"
				 data-kt-search-min-length="2"
				 data-kt-search-enter="enter"
				 data-kt-search-layout="menu"
				 data-kt-search-responsive="lg"
				 data-kt-menu-trigger="auto"
				 data-kt-menu-permanent="true"
				 data-kt-menu-placement="bottom-start">

				<div data-kt-search-element="toggle" class="d-flex d-lg-none align-items-center">
					<div class="btn btn-icon btn-active-light-primary">
						<i class="fas fa-search fs-1"></i> @* Use Font Awesome for consistency *@
					</div>
				</div>

				<form data-kt-search-element="form" class="d-none d-lg-block w-100 position-relative mb-5 mb-lg-0" autocomplete="off">
					<input type="hidden" />
					<i class="fas fa-search fs-2 fs-lg-1 text-gray-500 position-absolute top-50 translate-middle-y ms-5"></i> @* Font Awesome *@
					<input type="text" class="form-control form-control-solid ps-14" name="search" value="" placeholder="Search..." data-kt-search-element="input" />
					<span class="position-absolute top-50 end-0 translate-middle-y lh-0 d-none me-6" data-kt-search-element="spinner">
						<span class="spinner-border h-15px w-15px align-middle text-gray-500"></span>
					</span>
					<span class="btn btn-flush btn-active-color-primary position-absolute top-50 end-0 translate-middle-y lh-0 me-5 d-none" data-kt-search-element="clear">
						<i class="fas fa-times fs-2 fs-lg-1 me-0"></i> @* Font Awesome *@
					</span>
				</form>

				<div data-kt-search-element="content" class="menu menu-sub menu-sub-dropdown w-300px w-md-400px py-7 px-7 overflow-hidden">
					<div data-kt-search-element="wrapper">
						<div data-kt-search-element="categories">
							...
						</div>
						<div data-kt-search-element="results" class="d-none">
							...
						</div>
						<div data-kt-search-element="recently-viewed">
							...
						</div>
						<div data-kt-search-element="empty" class="text-center d-none">
							...
						</div>
					</div>
					<div data-kt-search-element="preferences">
						...
					</div>
				</div>
			</div>
		</h3>

		<div class="card-toolbar flex-row-fluid justify-content-end gap-5">
			<button type="button" class="btn btn-primary" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end">
				<i class="fas fa-download fs-2"></i> @* Font Awesome *@
				Export Report
			</button>

			<div id="kt_datatable_example_export_menu" data-kt-menu="true" class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-semibold fs-7 w-200px py-4">
				<div class="menu-item px-3">
					<a href="#" class="menu-link px-3" data-kt-export="copy">
						Copy to clipboard
					</a>
				</div>
				<div class="menu-item px-3">
					<a href="#" class="menu-link px-3" data-kt-export="excel">
						Export as Excel
					</a>
				</div>
				<div class="menu-item px-3">
					<a href="#" class="menu-link px-3" data-kt-export="csv">
						Export as CSV
					</a>
				</div>
				<div class="menu-item px-3">
					<a href="#" class="menu-link px-3" data-kt-export="pdf">
						Export as PDF
					</a>
				</div>
			</div>
			<div id="kt_datatable_example_buttons" class="d-none">
				<div class="dt-buttons btn-group flex-wrap">
					<button class="btn btn-secondary buttons-copy buttons-html5" tabindex="0" aria-controls="kt_datatable_example" type="button"><span>Copy</span></button>
					<button class="btn btn-secondary buttons-excel buttons-html5" tabindex="0" aria-controls="kt_datatable_example" type="button"><span>Excel</span></button>
					<button class="btn btn-secondary buttons-csv buttons-html5" tabindex="0" aria-controls="kt_datatable_example" type="button"><span>CSV</span></button>
					<button class="btn btn-secondary buttons-pdf buttons-html5" tabindex="0" aria-controls="kt_datatable_example" type="button"><span>PDF</span></button>
				</div>
			</div>
		</div>
	</div>

	<div class="card-body">
		<div class="table-responsive">
			@if (Model.Any())
			{
				<table id="kt_datatable_zero_configuration" class="table table-row-bordered gy-5">
					<thead>
						<tr class="fw-semibold fs-6 text-muted">
							<th>Name</th>
							<th>Status</th>
							<th>Created On</th>
							<th>Last Update On</th>
							<th class="text-end pe-10">Action</th>
						</tr>
					</thead>
					<tbody>

						@foreach (var category in Model)
						{
							<tr>
								<td>@category.Name</td>
								<td>
									<span class="js-status badge badge-light-@(category.IsDeleted? "danger": "success")">
										@(category.IsDeleted ? "Deleted" : "Available")
									</span>
								</td>
								<td>@category.CreatedOn.ToString("dd/MM/yyyy")</td>
								<td class="js-update-On"> @(category.LastUpdatedOn == null ? "No Update" : category.LastUpdatedOn.Value.ToString("dd/MM/yyyy"))</td>
								<td class="text-end">
									<a href="#" class="btn btn-light btn-active-light-primary btn-sm" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end" data-kt-menu-flip="top-end">
										Actions
										<span class="svg-icon fs-5 m-0">
											<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
												<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
													<polygon points="0 0 24 0 24 24 0 24"></polygon>
													<path d="M6.70710678,15.7071068 C6.31658249,16.0976311 5.68341751,16.0976311 5.29289322,15.7071068 C4.90236893,15.3165825 4.90236893,14.6834175 5.29289322,14.2928932 L11.2928932,8.29289322 C11.6714722,7.91431428 12.2810586,7.90106866 12.6757246,8.26284586 L18.6757246,13.7628459 C19.0828436,14.1360383 19.1103465,14.7686056 18.7371541,15.1757246 C18.3639617,15.5828436 17.7313944,15.6103465 17.3242754,15.2371541 L12.0300757,10.3841378 L6.70710678,15.7071068 Z" fill="currentColor" fill-rule="nonzero" transform="translate(12.000003, 11.999999) rotate(-180.000000) translate(-12.000003, -11.999999)"></path>
												</g>
											</svg>
										</span>
									</a>
									<div class="menu menu-sub menu-sub-dropdown w-100px py-4 text-center " data-kt-menu="true" id="kt_menu_@category.Id">
										<div class="menu-item px-3">
											<a asp-controller="Categories" asp-action="Edit" asp-route-id="@category.Id" class="menu-link px-3">Edit</a>
										</div>
										<div class="menu-item px-3">
											<a asp-controller="Categories" asp-action="Delete" asp-route-id="@category.Id" class="menu-link px-3 text-danger">Delete</a>
										</div>
										<div class="menu-item px-3 ">
											<a href="javascript:;" class="menu-link px-3 text-danger js-toggle-status" data-id="@category.Id">Toggle</a>
										</div>
									</div>
								</td>
							</tr>
						}


					</tbody>
				</table>
			}
			else
			{



				<div class="alert alert-danger d-flex align-items-center p-5 mb-10 border-warning">
					<i class="ki-duotone ki-shield-tick fs-2hx text-danger me-4"><span class="path1"></span><span class="path2"></span></i>                    <div class="d-flex flex-column">
						<h4 class="mb-1 text-danger"><i class="fa-solid fa-circle-exclamation  fs-2 me-1 text-danger"></i> No Categories Found</h4>
						<span>There are no categories to display.</span>
					</div>
				</div>



			}
		</div>
	</div>

	<input type="hidden" name="__RequestVerificationToken" value="@antiforgery.GetAndStoreTokens(Context).RequestToken" />



	@section Scripts {
		<script>
			$(document).ready(function() {
				$('.js-toggle-status').on('click', function() {
					let btn = $(this);
					let status = btn.closest('tr').find('.js-status');

					$.ajax({
						url: `Categories/ToggleStatus/${btn.data('id')}`,
						type: 'PUT',
						data: {//we add this to allow to ValidateAntiForgeryToken to work
							'__RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
						},
						success: (lastUpdateOn) => {
							let newStatus = status.text().trim() === 'Deleted' ? 'Available' : 'Deleted';
							status.text(newStatus).toggleClass('badge-light-danger badge-light-success');
							btn.closest('tr').find('.js-update-On').html(lastUpdateOn);
						}
					});
				});
			});

		</script>
	}
